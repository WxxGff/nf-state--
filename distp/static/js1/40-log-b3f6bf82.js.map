{"version":3,"file":"40-log-b3f6bf82.js","sources":["../../../src/views/state-log/log-table.vue","../../../src/views/state-global/40-log.vue"],"sourcesContent":["<template>\r\n  <el-button type=\"\" @click=\"state.$clearLog()\">清空日志</el-button><br>\r\n   <el-table\r\n    :data=\"list\"\r\n    :height=\"350\"\r\n    stripe\r\n    border=\"true\"\r\n    :default-sort=\"{ prop: 'time2', order: 'descending' }\"\r\n    style=\"width: 100%\"\r\n  >\r\n    <el-table-column sortable prop=\"time2\" label=\"时间\" width=\"90\" header-align=\"center\" />\r\n    <el-table-column prop=\"kind\" label=\"类型\" width=\"80\" header-align=\"center\"  />\r\n    <el-table-column prop=\"oldValue\" label=\"原值\" width=\"300\"  header-align=\"center\">\r\n      <template #default=\"scope\">\r\n        <el-input\r\n          v-model=\"scope.row.oldValue\"\r\n          type=\"textarea\"\r\n          :autosize=\"{ minRows: 2, maxRows: 5 }\"\r\n        ></el-input>\r\n      </template>\r\n    </el-table-column>\r\n    <el-table-column prop=\"newValue\" label=\"新值\" width=\"300\"  header-align=\"center\">\r\n      <template #default=\"scope\">\r\n        <el-input\r\n          v-model=\"scope.row.newValue\"\r\n          type=\"textarea\"\r\n          :autosize=\"{ minRows: 2, maxRows: 5 }\"\r\n        ></el-input>\r\n      </template>\r\n    </el-table-column>\r\n    <el-table-column prop=\"subValue\" label=\"提交\" width=\"300\" header-align=\"center\">\r\n      <template #default=\"scope\">\r\n        <el-input\r\n          v-model=\"scope.row.subValue\"\r\n          type=\"textarea\"\r\n          :autosize=\"{ minRows: 2, maxRows: 5 }\"\r\n        ></el-input>\r\n      </template>\r\n    </el-table-column>\r\n    <el-table-column prop=\"st\" label=\"定位(F12)\" width=\"50\"  header-align=\"center\">\r\n      <template #default=\"scope\">\r\n        <a href=\"javascript:\"\r\n          style=\"cursor:pointer;\"\r\n          @click=\"position(scope.row.callFun)\"\r\n        >\r\n          点我\r\n        </a>\r\n      </template>\r\n    </el-table-column>\r\n  </el-table>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n  import { computed } from 'vue'\r\n  import type { IState, StateLogInfo } from '../../../lib/types/type'\r\n\r\n  interface Props {\r\n    state: IState\r\n  }\r\n\r\n  // 对 defineProps() 的响应性解构\r\n  // 默认值会被编译为等价的运行时选项\r\n  const { state } = defineProps<Props>()\r\n\r\n\r\n  const getdate = (ts: number) => {\r\n    const now = new Date(ts)\r\n    const y = now.getFullYear()\r\n    const m = now.getMonth() + 1\r\n    const d = now.getDate()\r\n    return y + \"-\" + (m < 10 ? \"0\" + m : m) + \"-\" + (d < 10 ? \"0\" + d : d)\r\n      + \" \" + now.toTimeString().substr(0, 8)\r\n  }\r\n\r\n  const list = computed(() => {\r\n    const arr: Array<StateLogInfo> = []\r\n    state.$log.forEach((item, index) => {\r\n      const tmp: StateLogInfo = {\r\n        time: item.time,\r\n        time2: getdate(item.time),\r\n        kind: item.kind,\r\n        oldValue: JSON.stringify(item.oldValue, null, 2),\r\n        newValue: JSON.stringify(item.newValue, null, 2),\r\n        subValue: JSON.stringify(item.subValue, null, 2),\r\n        callFun: item.callFun\r\n      }\r\n      arr.push(tmp)\r\n    })\r\n\r\n    return arr\r\n  })\r\n\r\n  // 定位代码位置\r\n  const position = (stack: string) => {\r\n    console.log(stack)\r\n  }\r\n\r\n\r\n</script>","<template>\r\n  修改属性，不会记日志，其他变更都可以记录日志。（默认不记录，需要通过 option 设置）<br><br>\r\n  异步操作，建议使用 async、await，否则无法记录新值。<br><br>\r\n  可以定位触发状态变更的代码位置。<br><br>\r\n  状态：{{state1}}<br><br>\r\n  <el-button type=\"\" @click=\"myclick1\">修改属性（不记日志）</el-button><br>\r\n  <el-button type=\"\" @click=\"myclick12\">$patch 修改</el-button><br>\r\n  <el-button type=\"\" @click=\"myclick13\">$state 修改</el-button><br>\r\n  <el-button type=\"\" @click=\"myclick14\">action 修改</el-button><br><br>\r\n  <el-button type=\"\" @click=\"myclick15\">action 异步修改</el-button><br><br>\r\n\r\n  <el-button type=\"\" @click=\"state1.$patch({name: '模板改 patch'})\">模板 $patch修改</el-button><br>\r\n  <el-button type=\"\" @click=\"state1.$state = {name: '模板改 state '}\">模板 $state修改</el-button><br>\r\n  <el-button type=\"\" @click=\"state1.actionTest()\">模板 action修改</el-button><br><br>\r\n  <el-button type=\"\" @click=\"state1.$reset()\"> 重置</el-button> <br>\r\n\r\n  <state-log :state=\"state1\"/>\r\n  <hr>\r\n  js 文件里定义的状态：{{state2}}<br>\r\n  <state-log :state=\"state2\"/>\r\n\r\n   \r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\n  import { useStore } from '../../../lib/main'\r\n  \r\n  import type { StateGA } from '../../types/typs'\r\n  // 显示日志的组件\r\n  import stateLog from '../state-log/log-table.vue'\r\n\r\n  // 获取js文件里定义的状态的 id\r\n  import { globalTest } from './test-state'\r\n\r\n  // 获取在js文件的全局状态\r\n  // const state2 = useStore<StateGA>(flag)\r\n  const state2 = globalTest()\r\n\r\n  // 统一定义的全局状态\r\n  const state1 = useStore<StateGA>('stateLog')\r\n\r\n  const myclick1 = () => {\r\n    state1.name = '修改一下：' + new Date().valueOf()\r\n  }\r\n  \r\n  const myclick12 = () => {\r\n    state1.$patch({\r\n      name: '$patch修改' + new Date().valueOf(),\r\n      age: 18\r\n    })\r\n  }\r\n  \r\n  const myclick13 = () => {\r\n    state1.$state = {\r\n      name: '$state 修改' + new Date().valueOf(),\r\n      age: 18\r\n    }\r\n  }\r\n  \r\n  // actions 修改\r\n  const myclick14 = () => {\r\n    state1.actionTest()\r\n  }\r\n\r\n  // 异步 actions 修改\r\n  const myclick15 = () => {\r\n    state1.yibu()\r\n  }\r\n\r\n</script>"],"names":[],"mappings":"ghBAiEQ,EAAU,AAAC,GAAe,CACxB,KAAA,GAAM,GAAI,MAAK,CAAE,EACjB,EAAI,EAAI,cACR,EAAI,EAAI,SAAA,EAAa,EACrB,EAAI,EAAI,UACd,MAAO,GAAI,IAAO,GAAI,GAAK,IAAM,EAAI,GAAK,IAAO,GAAI,GAAK,IAAM,EAAI,GAChE,IAAM,EAAI,eAAe,OAAO,EAAG,CAAC,CAAA,EAGpC,EAAO,EAAS,IAAM,CAC1B,KAAM,GAA2B,CAAA,EACjC,SAAM,KAAK,QAAQ,CAAC,EAAM,IAAU,CAClC,KAAM,GAAoB,CACxB,KAAM,EAAK,KACX,MAAO,EAAQ,EAAK,IAAI,EACxB,KAAM,EAAK,KACX,SAAU,KAAK,UAAU,EAAK,SAAU,KAAM,CAAC,EAC/C,SAAU,KAAK,UAAU,EAAK,SAAU,KAAM,CAAC,EAC/C,SAAU,KAAK,UAAU,EAAK,SAAU,KAAM,CAAC,EAC/C,QAAS,EAAK,OAAA,EAEhB,EAAI,KAAK,CAAG,CAAA,CACb,EAEM,CAAA,CACR,EAGK,EAAW,AAAC,GAAkB,CAClC,QAAQ,IAAI,CAAK,CAAA,+6FC1DnB,KAAM,GAAS,IAGT,EAAS,EAAkB,UAAU,EAErC,EAAW,IAAM,CACrB,EAAO,KAAO,iCAAU,GAAI,QAAO,QAAQ,CAAA,EAGvC,EAAY,IAAM,CACtB,EAAO,OAAO,CACZ,KAAM,qBAAa,GAAI,MAAA,EAAO,QAAQ,EACtC,IAAK,EAAA,CACN,CAAA,EAGG,EAAY,IAAM,CACtB,EAAO,OAAS,CACd,KAAM,sBAAc,GAAI,MAAA,EAAO,QAAQ,EACvC,IAAK,EAAA,CACP,EAII,EAAY,IAAM,CACtB,EAAO,WAAW,CAAA,EAId,EAAY,IAAM,CACtB,EAAO,KAAK,CAAA"}